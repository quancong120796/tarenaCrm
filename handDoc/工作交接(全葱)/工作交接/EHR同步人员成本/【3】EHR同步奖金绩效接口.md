##### 一、业务场景

- CRM定时任务每个月从EHR系统同步当月的奖金绩效数据，并生成月支出和人员成本记录保存至crm系统作为月报中的人员成本来源
- 相关对接业务老师：EHR-臧玥老师，财务-马霓、王楠楠老师

----

##### 二、接口地址、参数

- 【crm代码文件名】：PersionnelBonusCostHandler.java
- 【定时任务执行器名称】：EHR人员成本奖金
- 【参数配置文件】:  *ehr.properties*
- 【正式环境接口地址】： http://hr.tedu.cn/services/HrGzDataSyncService
- 【测试环境接口地址】： http://192.168.191.225/services/HrGzDataSyncService
- 【方法名】:  syncToCrmSalaryInfo
- 其他参数(*infotype*|*username*|*password*)见配置文件

----

##### 三、调用时间参数说明

- 同步时间：定时任务目前为每月**2号24点**(即3号0点),若时间调整需提前调整定时任务的corn参数
- 时间参数：格式必须为yyyy-MM-01,且默认为月报当月的1号，例2020年9月月报则参数为2020-09-01(定时任务执行时间为10月2号24点)
- 若特殊情况可通过修改数据字典"**syn_ehr_param**"手动设置时间参数(增加字典选项编码:bonusparamdate,选项值:yyyy-MM-01)

----

##### 四、返回数据结构示例与说明

- 返回数据结构示例与说明

  ```xml
  <aacz0>2020-05-01</aacz0> 						<!--调用接口日期-->
  <a0122 code="0000210201"> 						<!--编制中心code(对应crm中的中心编码)-->
      <a01ag code="">								<!--EHR以及BU标签-->
  	    <a01ah code="">							<!--EHR二级BU标签(用于匹配实际中心)
  			<a0104 code="0229">					<!--公司编码code-->
  			    <e02aw code="11">				<!--岗位编码-->
                      <aadae>39128.00</aadae>		<!--工资-->
                      <aaaa0>9896.00</aaaa0>		<!--奖金、绩效-->
                      <aa8ap>5891.23</aa8ap>		<!--社保-->
                      <aa9aa>3000.00</aa9aa>		<!--公积金-->
                      <aadb9>0.00</aadb9>			<!--年终奖-->
                      <aadai>0.00</aadai>			<!--离职补偿-->
                      <pcount>4</pcount>			<!--在岗人数-->
  				</e02aw>
  			</a0104>
  		</a01ah>
  	</a01ag>
  </a0122>
  ```

##### 五、接口返回数据处理

- EHR二级BU匹配实际成本中心同在岗人数接口
- 插入月支出和人员成本数据，其中奖金数据取自接口返回数据的奖金绩效 

----

##### 六、系统查询入口

- 可在"**月支出和人员成本**"功能查询同步到crm的奖金绩效数
- 时间条件选择当月月末最后一天，例 查询10月的绩效数据:<img src="E:\需求\工作交接(全葱)\工作交接\文档附件\cutImages\人员成本绩效.png" alt="人员成本绩效" style="zoom:150%;" />
